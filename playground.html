<!DOCTYPE HTML>
	<html>
	<head>
		<title>Fun javascript playground</title>
		<link />
		<style>

		</style>
	</head>

	<body>
		<button id="btnClickMe" type="button">Click Me</button>
		<script>
			document.querySelector("btnClickMe").onclick = function(){ alert(5); };


			{ title : "Request Cancelled", message : "The rider has cancelled the request" }	


			exports.onRequestStatusChanged = functions.database.ref('/bases/{baseId}/test_requests/{requestId}').onWrite(event => {
				let title = 'Request Cancelled';
				let message = 'The rider has cancelled the request.';
				return loadUsers().then(users => {
					let tokens = users.map(user => user.pushToken);
					let payload = {
						notification : {
							title : title,
							body : message,
							sound : 'default',
							badge: '1',
						},
					};

					return admin.messaging().sendToDevice(tokens, payload);
				});

  
    // commented out code for other push notifications
	// let requestData = event.data.val()

	// let requestStateChanged = false;
	// let requestCreated = false;

	// if (!event.data.previous.exists()) {
	// 	// Do things here if request didn't exists before
	// 	// New Request logic
	// 	requestCreated = true;
	// }

	// if (!requestCreated && event.data.changed()) {
	// 	requestStateChanged = true;
	// }
	let title = 'New Request';
	let msg = 'There are New Request (s) avalible';

	// if (requestCreated) {

	// 	msg = `There are new request(s) available`;
	// }

	return loadUsers().then(users => {
		let tokens = [];
		for (let user of users) {
			tokens.push(user.pushToken);
		}
			  let payload = {
					notification: {
				title: title,
				body: msg,
				sound: 'default',
				badge: '1'
				}
				};
		return admin.messaging().sendToDevice(tokens, payload);
	});
	

});


		</script>
	</body>
</html>