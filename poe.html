<!DOCTYPE html>
<html>
<head>
<script src="javascript/framework.js"></script>
</head>
<body>
	<script>
		function relativeDamageReduction(armor, rawDamage){ return armor/(armor+10*rawDamage);  }
		function requiredArmorRating(rawDamage, relativeDamageReduced){ return (relativeDamageReduced*10*rawDamage)/(1-relativeDamageReduced); }
		function resultingDamage(armor, rawDamage){ return 10*Math.pow(rawDamage)/(armor+10*rawDamage); }
		function resultingMitigationFlat(armor, rawDamage){ return armor*rawDamage/(armor+10*rawDamage); }
		function defenseFactor(armor, rawDamage){ return (armor)/(10*rawDamage)+1; }

		var poe_data = (function(){
			function Member(name, rank, lastOnline, challengeCount){
				if(!(this instanceof Member)){ throw new Error("Must use new keyword with Member class"); }

			};
		})();

		//API
		var api = (function(){
			var _root = "https://www.pathofexile.com",
			    cors_service = "https://cors-anywhere.herokuapp.com";

			var cors_root = `${cors_service}/${_root}`;

			var endpoints = {
				characters : "character-window/get-characters",
				characterItems : "character-window/get-items",
				characterPassives : "character-window/get-passive-skills",
				stashItems : "character-window/get-stash-items",
				mtxStashItems : "character-window/get-mtx-stash-items",
				accountForCharacter : "character-window/get-account-name-by-character",
			};

			function _get(endpoint, values){
				var queryString = convertJSONToQueryString(values);
				return ajax.get(`${cors_root}/${endpoint}${queryString}`);
			}

			function getCharacters(accountName){ return _get(endpoints.characters, { 'accountName' : accountName }); }
			function getCharacterItems(accountName, character){ 
				return _get(endpoints.characterItems,{ 'accountName' : accountName, 'character' : character });
			}
			//reqData is 0 or 1, setting to 1 seems to give detailed passive info
			function getCharacterPassives(accountName, character, reqData){
				return _get(endpoints.characterItems,{ 'accountName' : accountName, 'character' : character, 'reqData' : reqData });
			}
			//tabs is 0 or 1, indicates whether to show name, position, colors. Sig: String, String, Number, Number
			//Requires POE SESSION ID, which can't be set from a web browser
			function getStashItems(league,accountName,tabs,tabIndex){
				return _get(endpoints.stashItems,
					{ 'league' : league, 'accountName' : accountName,'tabs' : tabs, 'tabIndex' : tabIndex });
			}
			function getAccountForCharacter(characterName){ return _get(endpoints.accountForCharacter, { character : characterName }); }


			function convertJSONToQueryString(parameters){
				var joinedParameters = Object.keys(parameters).map(key => `${key}=${parameters[key]}`).join("&");
				return `?${joinedParameters}`;
			}

			return {
				account : {
					characters : getCharacters,
					character : {
						items : getCharacterItems,
						passives : getCharacterPassives,
					},
					findByCharacter : getAccountForCharacter,
				},
				test : function(){ return ajax.get(cors_root); },
			};
		})();


		//ajax.get("https://cors-anywhere.herokuapp.com/https://www.pathofexile.com/character-window/get-items?accountName=daesthelos&character=Hvel");


		var endpoint = "https://cors-anywhere.herokuapp.com/http://www.pathofexile.com/api/trade/search/Betrayal";
		var headers = [
			{"Content-Type":"application/json"},
			{"Accept-Language":"en-us"},
			{"X-Requested-With" : "XMLHttpRequest"},
			//{"Cookie":"POESESSID=99db6e1b992cd7fa5bc717a81a4bd3f7; _ga=GA1.2.1826094589.1540326097; _gat=1; _gid=GA1.2.1255992888.1548013395; __cfduid=d250d4eb6c4f9fffa4621abeb6e38f46c1543432234; stored_data=1"}
		];

		var test = "https://cors-anywhere.herokuapp.com/http://api.pathofexile.com/public-stash-tabs";

		var _POESESSID = "POESESSID=b4f8eff3c8588a48552a96e86b15d8a1"

		var root = "https://www.pathofexile.com/";

		var currentStashes = [];

		var x = {
			next_change_id : 0,
			stashes : [],
		};

		/*ajax.get(test).then(data=>{
			responseData = data.value;

			x.next_change_id = responseData.next_change_id;
			x.stashes = responseData.stashes.filter(z=>z.public);
		}).catch(y=>{
			console.log(y);
		});*/

	</script>
</body>
</html>
