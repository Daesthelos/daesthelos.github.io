<!DOCTYPE HTML>
<html>
	<head>
		<title>Index placeholder</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
	<link rel="shortcut icon" href="images/poe_favicon.png" sizes="32x32">
	<meta name="theme-color" content="#191919">

	<link href="css/index.css" rel="stylesheet" type="text/css" />
	<script src="javascript/framework.js"></script>
	</head>
	<body>
	<div>
		<!-- <img src="https://s3.amazonaws.com/baconmockup/img/bm-home-280.jpg" style="width:100%; height:100%;object-fit: contain"></img> -->
	</div>
	<header class="header" style="border:1px solid orange; height:64px">
	</header>
	<div class="sidebar" style="border:1px solid yellow;">
		<ul class="feature-list">
			<li>Side bar item</li>
		</ul>
	</div>
	<main class="main" style="border:1px solid green">
		<div>
			<input type="file" name="avatar" accept="image/*" multiple/>
		</div>
		<img name="preview" />
		<div name="previews" />
		<!--<ul style="margin: 0px;padding:0px">
			<li style="list-style-type: none" class="item">
				<img src="https://s3.amazonaws.com/baconmockup/img/bm-home-280.jpg" style="width:100%; height:500px"></img>
				<a href="colortest">ColorTest</a>
			</li>
			<li>
				<a href="playground">Playground</a>
			</li>
			<li>
				<a href="poe">Path of Exile</a>
			</li>
			<li>
				<a href="SettingConfig">Setting config test page</a>
			</li>
			<li>
				<a href="WavesAreVeryExciting">Waves Are Very Exciting (WAVE)</a>
			</li>
			<li>
				<a href="YoutubePage">Youtube Song List</a>
			</li>
		</ul>-->
	</main>
	<footer class="footer"  style="border:1px solid blue;">
		<h3>Footer Info</h2>
		&nbsp;
	</footer>
	<script>
		const fileUpload = document.querySelector("[name='avatar']");
		const preview = document.querySelector("[name='preview']");
		const previews = document.querySelector("[name='previews']");

		const onUpload = async (event) => {
			const files = Array.from(event.target.files);

			const conversionPromises = files.map(file => convertImageTo64String(file));

			Promise.all(conversionPromises).then((imageStrings) => {
				while(previews.lastChild){ previews.removeChild(previews.lastChild); }

				imageStrings.forEach(imgSource => {
					const img = document.createElement("img");
					img.src = imgSource;
					img.height = "200";
					img.width = "200";
					previews.append(img);
				});
			}).catch(e => console.warn(e.message));
		};

		(()=>{
			fileUpload.onchange = onUpload;
		})();

		const convertImageTo64String = (file) => {
			const tempFileReader = new FileReader();

			return new Promise((resolve, reject) => {
				tempFileReader.onerror = () => {
					tempFileReader.abort();
					reject(new Error("Issue occurred during conversion"));
				};

				tempFileReader.onload = () => {
					resolve(tempFileReader.result);
				};
				tempFileReader.readAsDataURL(file);
			});
		}

	</script>
	</body>
</html>